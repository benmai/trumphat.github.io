<!DOCTYPE html>
<html>
<head>

  <title>Donald Trump Hat Generator</title>

  <!-- Demo CSS -->
  <link href="css.css" rel="stylesheet" type="text/css" />

  <!-- Meme script -->
  <script src="meme.js"></script>

  <!-- Demo scripts -->
  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>
  <script>/* jQuery-FontSpy.js v3.0.0
 * https://github.com/patrickmarabeas/jQuery-FontSpy.js
 *
 * Copyright 2013, Patrick Marabeas http://pulse-dev.com
 * Released under the MIT license
 * http://opensource.org/licenses/mit-license.php
 *
 * Date: 02/11/2015
 */

(function( w, $ ) {

  fontSpy = function  ( fontName, conf ) {
    var $html = $('html'),
        $body = $('body'),
        fontFamilyName = fontName;

        // Throw error if fontName is not a string or not is left as an empty string
        if (typeof fontFamilyName !== 'string' || fontFamilyName === '') {
          throw 'A valid fontName is required. fontName must be a string and must not be an empty string.';
        }

    var defaults = {
        font: fontFamilyName,
        fontClass: fontFamilyName.toLowerCase().replace( /\s/g, '' ),
        success: function() {},
        failure: function() {},
        testFont: 'Courier New',
        testString: 'QW@HhsXJ',
        glyphs: '',
        delay: 50,
        timeOut: 1000,
        callback: $.noop
    };

    var config = $.extend( defaults, conf );

    var $tester = $('<span>' + config.testString+config.glyphs + '</span>')
        .css('position', 'absolute')
        .css('top', '-9999px')
        .css('left', '-9999px')
        .css('visibility', 'hidden')
        .css('fontFamily', config.testFont)
        .css('fontSize', '250px');

    $body.append($tester);

    var fallbackFontWidth = $tester.outerWidth();

    $tester.css('fontFamily', config.font + ',' + config.testFont);

    var failure = function () {
      $html.addClass("no-"+config.fontClass);
      if( config && config.failure ) {
        config.failure();
      }
      config.callback(new Error('FontSpy timeout'));
      $tester.remove();
    };

    var success = function () {
      config.callback();
      $html.addClass(config.fontClass);
      if( config && config.success ) {
        config.success();
      }
      $tester.remove();
    };

    var retry = function () {
      setTimeout(checkFont, config.delay);
      config.timeOut = config.timeOut - config.delay;
    };

    var checkFont = function () {
      var loadedFontWidth = $tester.outerWidth();

      if (fallbackFontWidth !== loadedFontWidth){
        success();
      } else if(config.timeOut < 0) {
        failure();
      } else {
        retry();
      }
    }

    checkFont();
    }
  })( this, jQuery );
  $.fn.ready(function() {
var preview_timeout_id=false;
$(document).ready(function() {
  $('html').addClass(('ontouchstart' in window || navigator.maxTouchPoints?'has-touch':'has-click'));
  $('#all-line').on('focus',function(){
    $('html').addClass('input-mode');
  });
  $('#all-line').on('blur',function(){
    $('html').removeClass('input-mode');
  });
  $('.ui-msg').on('click',function(){
    $('#all-line').focus();
    $('#all-line').select();
    $(this).remove();
  });
  fontSpy('Libre Baskerville', {    
    success: function(){
      Meme('donald_796.jpg', 'canvas');


      $('button.save-btn').on('click',function(){
        var canvas = $('#canvas')[0],
            image = canvas.toDataURL("image/png").replace("image/png", "image/octet-stream"),  // here is the most important part because if you dont replace you will get a DOM 18 exception.
            link = document.createElement('a'),/// create an "off-screen" anchor tag
            e;

        
        link.download = "donald--"+$('#all-line').val().replace(/[\s\[\].,\/#!$%\^&\*;:{}=_`~]/gi,'-')+".png";/// the key here is to set the download attribute of the a tag

        /// convert canvas content to data-uri for link. When download
        /// attribute is set the content pointed to by link will be
        /// pushed as "download" in HTML5 capable browsers
        link.href = canvas.toDataURL();

        /// create a "fake" click-event to trigger the download
        if (document.createEvent) {

            e = document.createEvent("MouseEvents");
            e.initMouseEvent("click", true, true, window,
                             0, 0, 0, 0, 0, false, false, false,
                             false, 0, null);
            link.dispatchEvent(e);
        } else if (link.fireEvent) {

            link.fireEvent("onclick");
        }
      });
      $('#all-line').keyup(function() {
        if(preview_timeout_id!==false){clearTimeout(preview_timeout_id);}
        preview_timeout_id=setTimeout(function(){

          //Meme('donald_796.jpg', 'canvas', $('#top-line').val().toUpperCase(), $('#bottom-line').val().toUpperCase());
          Meme('donald_796.jpg', 'canvas', $('#all-line').val().toUpperCase());
          //Meme('donald_796.jpg', 'canvas', $('#all-line').val());
        },300);
      });
      $('#all-line').keyup();
    }
  });

});

  });

  </script>

<!-- <link href='https://fonts.googleapis.com/css?family=Droid+Sans:400,700|Libre+Baskerville:400,400italic,700' rel='stylesheet' type='text/css'> -->
<link href='https://fonts.googleapis.com/css?family=Libre+Baskerville:400,400italic,700|Open+Sans:400,300,700,600' rel='stylesheet' type='text/css'>
</head>

<body>
  <a href="javascript:;" class="ui-msg"><div class="as-tbl"><p class="as-tcl"><span class="tap-msg">Tap</span><span class="click-msg">Click</span> to<br/>Customize</p></div></a>

  
    <!-- <input id="top-line" placeholder="top line">
    <input id="bottom-line" placeholder="bottom line"> -->
    <main>
     <section class="textarea-wrapper">
        <div class="text-area-holder"><textarea id="all-line" placeholder="Enter Your Text">MAKE AMERICA 
GREAT AGAIN</textarea>
        </div>
        <div class="save-button-wrapper"><button class="save-btn">Save</button></div>
</section>
      <section class="canvas-wrapper"><canvas id="canvas"></canvas></section>
    </main>
    <div class="credits">
      <p>Original Image Credit by Rick Wilking / Reuters</p>
      <p>Github Forked: <a href="https://github.com/BuddyMeme/Meme.js" target="_blank">Meme.js</a></p>
    </div>
  
</body>
</html>
